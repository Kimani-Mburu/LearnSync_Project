{% extends 'base.html' %}
{% load static %}

{% block extra_stylesheets %}
    <link rel="stylesheet" href="{% static 'css/forum.css' %}">
{% endblock %}

{% block main %}
  
        <div class="row" style="margin-top:7px;">
            <div class="col-lg-3 sidebar">
                <section class="user-stats mb-4 p-3 bg-dark-subtle rounded shadow-sm" style="margin-left: 5px; margin-right: 5px;">
                    <div class="container py-4">
                        <div class="user-profile d-flex align-items-center mb-4 p-3 bg-light rounded shadow-sm">
                            <img src="{% static 'img/img.jpg' %}" alt="User Avatar" style="width: 60px; height: 60px; object-fit: cover; border-radius: 50%; margin-right: 15px; border: 2px solid #007BFF;">
                            <div>
                                <div class="d-flex flex-column flex-md-row align-items-md-center">
                                    <span class="badge badge-info mb-1 mb-md-0" style="font-size: 17px; background-color: #17a2b8;">{{user.username}} </span>
                                </div>
                                <p class="mb-0" style="font-size: 14px; color: #6c757d;">Status: <span class="text-success">Online</span></p>
                            </div>
                            <div class="ml-auto">
                                <span class="status-indicator rounded-circle bg-success"></span>
                            </div>
                        </div>
                                  
                        <div class="list-group mb-4" style="background-color: #f8f9fa; border: none;">
                            <div class="list-group-item d-flex align-items-center py-2">
                                <div class="col-2">
                                    <i class="bi bi-person-fill" style="font-size: 1.2rem; color: #17a2b8;"></i>
                                </div>
                                <div class="col-7">
                                    <span class="font-weight-bold text-dark">Followers:</span>
                                </div>
                                <div class="col-3 text-right">
                                    <span class="badge badge-light text-dark px-2 py-1" style="background-color: #d1d8e0;">2.5K</span>
                                </div>
                            </div>
                            <div class="list-group-item d-flex align-items-center py-2">
                                <div class="col-2">
                                    <i class="bi bi-file-earmark-text" style="font-size: 1.2rem; color: #FF5733;"></i>
                                </div>
                                <div class="col-7">
                                    <span class="font-weight-bold text-dark">Posts:</span>
                                </div>
                                <div class="col-3 text-right">
                                    <span class="badge badge-light text-dark px-2 py-1" style="background-color: #d1d8e0;">150</span>
                                </div>
                            </div>
                            <div class="list-group-item d-flex align-items-center py-2">
                                <div class="col-2">
                                    <i class="bi bi-heart-fill" style="font-size: 1.2rem; color: #dc3545;"></i>
                                </div>
                                <div class="col-7">
                                    <span class="font-weight-bold text-dark">Likes:</span>
                                </div>
                                <div class="col-3 text-right">
                                    <span class="badge badge-light text-dark px-2 py-1" style="background-color: #d1d8e0;">900</span>
                                </div>
                            </div>
                            <div class="list-group-item d-flex align-items-center py-2">
                                <div class="col-2">
                                    <i class="bi bi-trophy-fill" style="font-size: 1.2rem; color: #28a745;"></i>
                                </div>
                                <div class="col-7">
                                    <span class="font-weight-bold text-dark">Badges:</span>
                                </div>
                                <div class="col-5 col-md-6 text-right">
                                    <span class="badge badge-light text-dark px-2 py-1" style="background-color: #d1d8e0;">Gold </span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <a href="#" class="btn btn-secondary btn-sm"><i class="bi bi-pencil"></i> Edit Profile</a>
                        </div>
                        
                    </div>
                </section>
                                
                <section class="categories mb-4 p-3 bg-dark-subtle rounded shadow-sm" style="margin-left: 5px; margin-right: 5px;">
                    <h3 class="mb-3" style="color: #007BFF;">Categories</h3>
                    <div class="d-flex flex-wrap">
                        <a href="#" class="badge bg-info text-white mx-1 my-1 px-3 py-2 rounded-lg" style="text-decoration: none; transition: background-color 0.3s ease;">
                            <i class="bi bi-tags"></i> Technology
                        </a>
                        <a href="#" class="badge bg-info text-white mx-1 my-1 px-3 py-2 rounded-lg" style="text-decoration: none; transition: background-color 0.3s ease;">
                            <i class="bi bi-tags"></i> Science
                        </a>
                        <!-- Add more categories... -->
                    </div>
                </section>
                
                
                <section class="latest-posts mb-4 p-3 bg-dark-subtle rounded shadow-sm" style="margin-left: 5px; margin-right: 5px;">
                    <h3 class="mb-3" style="color: #28A745;">Latest Posts</h3>
                    <ul class="list-group">
                        <li class="list-group-item" style="background-color: #f8f9fa; transition: background-color 0.3s ease;">
                            <span style="font-size: 14px; color: #6c757d;"><i class="bi bi-calendar"></i> August 15, 2023</span>
                            <p class="mb-0" style="font-size: 16px; color: #333;">The Future of AI: Opportunities and Challenges</p>
                            <div class="separator" style="width: 100%; height: 1px; background-color: #ccc; margin-top: 10px; display: none;"></div>
                        </li>
                        <li class="list-group-item" style="background-color: #f8f9fa; transition: background-color 0.3s ease;">
                            <span style="font-size: 14px; color: #6c757d;"><i class="bi bi-calendar"></i> August 12, 2023</span>
                            <p class="mb-0" style="font-size: 16px; color: #333;">Mindfulness Meditation for Stress Relief</p>
                            <div class="separator" style="width: 100%; height: 1px; background-color: #ccc; margin-top: 10px; display: none;"></div>
                        </li>
                        <!-- Add more latest posts... -->
                    </ul>
                </section>
                
            </div>

            <div class="col-lg-6 content">
                <!-- Write a Post Section -->
                <section class="write-post-section card mb-3">
                    <div class="card-body">
                        <form class="post-form" method="POST" action="{% url 'create_post' %}">
                            {% csrf_token %}
                            <input type="hidden" name="thread_id" value="{{ thread.id }}">
                            <div class="form-group">
                                {{ create_post_form.content.label_tag }}
                                {{ create_post_form.content }}
                                {% if create_post_form.content.errors %}
                                    <div class="alert alert-danger">
                                        {{ create_post_form.content.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="form-group d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <label for="post-photo" class="btn btn-light btn-sm rounded-pill mr-2">
                                        <i class="bi bi-image"></i> Add Photo
                                    </label>
                                    <input type="file" id="post-photo" class="d-none" accept="image/*">
                                </div>
                                <button type="submit" class="btn btn-primary btn-sm rounded-pill">Post</button>
                            </div>
                        </form>
                    </div>
                </section>
                
                
                {% include 'forum/posts.html' %}
                

            <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="shareModalLabel">Share</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="list-group">
                                <a href="#" class="list-group-item list-group-item-action">
                                    <i class="bi bi-envelope-fill mr-2"></i> Email
                                </a>
                                <a href="#" class="list-group-item list-group-item-action">
                                    <i class="bi bi-twitter mr-2"></i> Twitter
                                </a>
                                <a href="#" class="list-group-item list-group-item-action">
                                    <i class="bi bi-facebook mr-2"></i> Facebook
                                </a>
                                <a href="#" class="list-group-item list-group-item-action">
                                    <i class="bi bi-linkedin mr-2"></i> LinkedIn
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            </div>
            
            <div class="col-lg-3 sidebar">
                <!-- Trending Topics Section -->
                <section class="discussions mb-4 p-3 bg-dark-subtle rounded shadow-sm" style="margin-right: 5px;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="mb-0" style="color: #1DA1F2; font-size: 20px;">Discussions</h3>
                        <button id="newDiscussionButton" class="btn btn-primary btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#createDiscussionModal">New Discussion</button>
                    </div>
                    <ul class="list-group">
                    
                    <!-- Home Thread -->
                    <a href="{% url 'forum_two' %}" class="list-group-item list-group-item-action d-flex flex-column align-items-start py-3 {% if not selected_thread %}active{% endif %}" style="border: none; background-color: #f8f9fa; position: relative; transition: background-color 0.3s ease; color: #000; text-decoration: none;" onmouseover="this.style.backgroundColor='#e4e6eb'; this.querySelector('.separator').style.display='block';" onmouseout="this.style.backgroundColor='#f8f9fa'; this.querySelector('.separator').style.display='none';">
                        <div class="d-flex justify-content-between align-items-center w-100">
                            <div>
                                <small class="text-muted" style="font-size: 12px;">{% if selected_thread %}{{ selected_thread.category.name }}{% endif %}</small>
                                <span style="font-size: 16px;">Home</span>
                            </div>
                            <div>
                                <small class="text-muted">
                                    <i class="bi bi-chat-dots text-secondary mr-1" style="font-size: 14px;"></i> 
                                    {% if selected_thread %}{{ selected_thread.post_set.count }} Posts{% endif %}
                                </small>
                            </div>
                        </div>
                        <div class="separator" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 1px; background-color: #ccc; display: none;"></div>
                    </a>

                
                        <!-- Other Threads -->
                        {% for thread in threads %}
                        <a href="#" class="list-group-item list-group-item-action d-flex flex-column align-items-start py-3 {% if selected_thread == thread %}active{% endif %}" style="border: none; background-color: #f8f9fa; position: relative; transition: background-color 0.3s ease; color: #000; text-decoration: none;" onmouseover="this.style.backgroundColor='#e4e6eb'; this.querySelector('.separator').style.display='block';" onmouseout="this.style.backgroundColor='#f8f9fa'; this.querySelector('.separator').style.display='none';">
                            <small class="text-muted" style="font-size: 12px;">{{ thread.category.name }}</small>
                            <span style="font-size: 16px;">{{ thread.title }}</span>
                            <small class="text-muted"><i class="bi bi-chat-dots text-secondary mr-1" style="font-size: 14px;"></i> {{ thread.post_set.count }} Posts</small>
                            <div class="separator" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 1px; background-color: #ccc; display: none;"></div>
                        </a>
                        {% endfor %}
                        <!-- Add more threads... -->
                    </ul>
                </section>
                
                
                
                <!-- Create Discussion Modal -->
                <div class="modal fade" id="createDiscussionModal" tabindex="-1" role="dialog" aria-labelledby="createDiscussionModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title" id="createDiscussionModalLabel">Create New Discussion</h5>
                                <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form method="POST" action="{% url 'forum_two' %}">
                                    {% csrf_token %}
                                    <div class="mb-3">
                                        <label for="discussionCategory" class="form-label">Category</label>
                                        <select class="form-select" id="discussionCategory" name="category">
                                            {% for category in categories %}
                                            <option value="{{ category.id }}">{{ category.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="discussionName" class="form-label">Discussion Name</label>
                                        <input type="text" class="form-control" id="discussionName" name="title" placeholder="Enter discussion name">
                                    </div>
                                    <div class="text-center">
                                        <button type="submit" class="btn btn-primary">Create Discussion</button>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <p class="text-muted">By creating a discussion, you agree to our <a href="#">terms and conditions</a>.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- People You May Know Section -->
                <section class="people-you-may-know mb-4 p-3 bg-dark-subtle rounded shadow-sm">
                    <h3 class="mb-3" style="color: #1DA1F2; font-size: 20px;">People You May Know</h3>
                    <ul class="list-group">
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center py-2" style="border: none; background-color: #f8f9fa; margin-right:5px;">
                            <img src="{% static 'img/img.jpg' %}" alt="User Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                            <div>
                                <span class="font-weight-bold text-dark">Jane Doe</span>
                                <p class="mb-0" style="font-size: 14px; color: #6c757d;">2 mutual connections</p>
                            </div>
                        </a>
                        <!-- More people you may know... -->
                    </ul>
                </section>
            </div>
            


        </div>
{% endblock %}

{% block extra_scripts %}
<script>

    function toggleLike(likeButton) {
        // Toggle the heart icon color
        likeButton.querySelector('i.bi-heart-fill').classList.toggle('text-danger');
        
        // Update the like count
        const likeCount = likeButton.querySelector('.like-count');
        const isLiked = likeButton.querySelector('i.bi-heart-fill').classList.contains('text-danger');
        
        if (isLiked) {
            likeCount.textContent = parseInt(likeCount.textContent) + 1;
        } else {
            likeCount.textContent = parseInt(likeCount.textContent) - 1;
        }
    }
    
    function toggleReplyForm(replyButton) {
        const replyForm = replyButton.closest('.card-body').querySelector('.reply-form');
        replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';
    }
    
    function openSharePopup() {
        $('#shareModal').modal('show');
    }

    document.getElementById('newDiscussionButton').addEventListener('click', function() {
        $('#createDiscussionModal').modal('show');
    });
    
</script>  

<script>
    var currentPage = 1;

    function loadMorePosts() {
        $.ajax({
            url: `/forum/?page=${currentPage}`,
            method: 'GET',
            success: function(data) {
                if (data.posts.length > 0) {
                    currentPage++;
                    for (var i = 0; i < data.posts.length; i++) {
                        var post = data.posts[i];
                        var postHtml = `
                            <!-- Paste your post HTML structure here -->
                            <div class="card mb-3">
                                <!-- Your card content here -->
                                <!-- Replace placeholders with post data like '{{ post.creator.username }}', '{{ post.content }}', etc. -->
                            </div>
                        `;
                        $('.posts-section').append(postHtml);
                    }
                }
            },
            error: function(error) {
                console.log('Error fetching posts:', error);
            }
        });
    }

    $(document).ready(function() {
        // Initial load of posts
        loadMorePosts();

        // Infinite scrolling logic
        $(window).scroll(function() {
            if ($(window).scrollTop() + $(window).height() >= $(document).height() - 300) {
                loadMorePosts();
            }
        });
    });
</script>

{% endblock %}
